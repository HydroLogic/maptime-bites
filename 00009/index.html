<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title></title>
<!-- RSVP -->
<script src="./rsvp/dist/rsvp.js"></script>


<!-- Firebase -->
<script src="https://cdn.firebase.com/js/client/1.0.17/firebase.js"></script>

<!-- GeoFire -->
<script src="https://cdn.firebase.com/libs/geofire/2.1.0/geofire.min.js"></script>
<script src='http://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js'></script>
  <link href='http://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet' />
  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
  </style>
</head>
<body>
<div id='map'></div>
<script type='text/javascript'>

// Create a Firebase reference where GeoFire will store its information
var firebaseRef = new Firebase("https://grafa.firebaseio.com/");

// Create a GeoFire index
var geoFire = new GeoFire(firebaseRef);

var ref = geoFire.ref();  // ref === firebaseRef

var map = L.mapbox.map('map', 'grafa.hf3lmhlf');


map.on('click', function(e) {
  var coords = e.latlng.lat + ','+e.latlng.lng;
  // console.log(coords);
  geoFire.set("coords", [e.latlng.lat,e.latlng.lng]).then(function() {
    location.reload(true);
  }, function(error) {
    // console.log("Error: " + error);
  });
  
});


geoFire.get("coords").then(function(location) {
  if (location === null) {
    console.log("Provided key is not in GeoFire");
  }
  else {
    map.panTo(location);
    console.log(location);
    var marker = L.marker(location).addTo(map);
    marker.bindPopup("<b>Hey!</b><br>I'm over here! Click on the map and let me know where you're at. k?").openPopup();
  }
}, function(error) {
  console.log("Error: " + error);
});

</script>
</body>
</html>
